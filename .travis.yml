language: go
go: 1.9.2
env:
  global:
  - PATH=/home/travis/gopath/bin:$PATH
  - GHREPO_NAME=$(basename ${TRAVIS_REPO_SLUG})
  - LINUXX64_ARCHIVENAME=${GHREPO_NAME}_x86_64-pc-linux-gnu_${TRAVIS_TAG}
  -  WINDOWS_ARCHIVENAME=${GHREPO_NAME}_i686-mingw32_${TRAVIS_TAG}
  -   MACOSX_ARCHIVENAME=${GHREPO_NAME}_x86_64-apple-darwin_${TRAVIS_TAG}
  - LINUXARM_ARCHIVENAME=${GHREPO_NAME}_arm-linux-gnueabihf_${TRAVIS_TAG}

deploy:
  provider: releases
  api_key:
    secure: on5j2XaZtrmP6s0pUhJqEI0PDe4YZUJ/ombDK4dNIEXp9eRwhS6eS0kxUrMRk7a1DZz5NYK5jVJSIAQhU8aARBocXqg1+2TGOq8dUVaJx+Qtyaxw8AvQjMKluRsbgCCmX1dLFl08cB/zFvqhqD3azkvesLysCzS2EKjCA55sMu+BaFbKUxZpVLd1wdreVF8MO5r9Pv3BNSQg9pmyzF/TWGSC3Oz8mE/U0UVo3CPyDNtCYchBMYgrzCV5amQWzdNg7emSK6xN7fjDI2euoDZOP76/DRvjuz99wu8c/p7y6QnAJnBkt2YcAx/eYqOp/pMh9T8s47YX5BJv+kPRAFILlZbm5mqSP2tZduCoT2OnA1awVO8unNWvAFkU9oiUG7Xi7eS+Xa+W/wnu59Ll5LmgraKWf+3gi4wHIB/cc8HiC7O4jjgDRvIULiqt0vb7EGEDeCj6N+lh2n4RBCTC8SSib07W7QHJkHKAd09K8XCIKnhTyBFVHD0b4WQBZaFbnIfbu+W8C+5fZ4LFOp6UqErheJ6MTb215d1fsWf1D+xsDiGZfzDPdiIKVk1KeV2Y+MKcwtf7bMrCXzql1D3cdfREoPG0JF5rw4FPVpwCXQiZBnOZzWw0RC0OGNxeHHZeEUImQfzzXOzMKadXKIaFTRVA54bLF2wqfiSpXgtzSQAkBfc=
  file:
    - "${LINUXX64_ARCHIVENAME}.tar.bz2"
    -  "${WINDOWS_ARCHIVENAME}.tar.bz2"
    -   "${MACOSX_ARCHIVENAME}.tar.bz2"
    - "${LINUXARM_ARCHIVENAME}.tar.bz2"
  skip_cleanup: true
  on:
    tags: true

install:
- go get -v github.com/mitchellh/gox

script:
- GOOS=linux   GOARCH=amd64 go build -o  pkg/linux_amd64/${GHREPO_NAME}/${GHREPO_NAME}
- GOOS=windows GOARCH=386   go build -o  pkg/windows_386/${GHREPO_NAME}/${GHREPO_NAME}.exe
- GOOS=darwin  GOARCH=amd64 go build -o pkg/darwin_amd64/${GHREPO_NAME}/${GHREPO_NAME}
- GOOS=linux   GOARCH=arm GOARM=6 go build -o  pkg/linux_arm7/${GHREPO_NAME}/${GHREPO_NAME}
- cp Makefile.template  pkg/linux_amd64/${GHREPO_NAME}
- cp Makefile.template  pkg/windows_386/${GHREPO_NAME}
- cp Makefile.template pkg/darwin_amd64/${GHREPO_NAME}
- cp Makefile.template   pkg/linux_arm7/${GHREPO_NAME}
- bash -c "cd  pkg/linux_amd64/ && tar cvfj ${PWD}/${LINUXX64_ARCHIVENAME}.tar.bz2 ${GHREPO_NAME}"
- bash -c "cd  pkg/windows_386/ && tar cvfj  ${PWD}/${WINDOWS_ARCHIVENAME}.tar.bz2 ${GHREPO_NAME}"
- bash -c "cd pkg/darwin_amd64/ && tar cvfj   ${PWD}/${MACOSX_ARCHIVENAME}.tar.bz2 ${GHREPO_NAME}"
- bash -c "cd   pkg/linux_arm7/ && tar cvfj ${PWD}/${LINUXARM_ARCHIVENAME}.tar.bz2 ${GHREPO_NAME}"
